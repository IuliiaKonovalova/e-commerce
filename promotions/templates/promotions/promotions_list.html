{% extends 'base.html' %}
{% load static %}

{% block content %}
  <div class="promotions">
    <section class="promotion__header">
      <h1 class="promotions__title" >Promotions</h1>
      <!-- Add button add promotion -->
      <div class="promotions__add">
        <a href="#" class="btn btn-primary promotions__add--btn" aria-label="Add promotion">
          <i class="fa fa-plus-circle"></i>
          Add Promotion
        </a>
      </div>
    </section>
    {% if promotions %}
      <div class="promotions__table">
        <div class="promotions__table--titles">
          <div class="promotions__table--title">Name</div>
          <div class="promotions__table--title">Time</div>
          <div class="promotions__table--title">Active</div>
          <div class="promotions__table--title">Code</div>
          <div class="promotions__table--title">Description</div>
        </div>
        {% for promotion in promotions %}
          <section class="promotion" data-id="{{ promotion.id }}">
            <h2 class="promotion__title">{{ promotion.name }}</h2>
            <p class="promotion__date">{{ promotion.start_date|date:"d/m/Y" }} - {{ promotion.end_date|date:"d/m/Y" }}</p>
            <p class="promotion__status">{{ promotion.active }}</p>
            <p class="promotion__code">{{ promotion.promotion_code }}</p>
            <p class="promotion__description">{{ promotion.description }}</p>
            <div class="promotion__products hidden">
              {% for product_inventory in promotion.products_inventory_in_promotion.all %}
                <a class="promotion__product" data-attr="{{ product_inventory.id }}" href="">
                  <strong>{{ product_inventory.sku }}</strong>
                  <div>{{ product_inventory.product.name }}</div>
                  {% if product_inventory.attribute_values %}
                    {% for value in product_inventory.get_attribute_values %}
                      <strong>{{ value.attribute_value }}</strong>
                    {% endfor %}
                  {% endif %}
                </a>
              {% endfor %}
            </div>
          </section>
        {% endfor %}
      </div>
    {% else %}
      <div class="">
        <strong>No promotions found.</strong>
      </div>
    {% endif %}
  </div>


{% endblock %}

{% block postloadjs_extra %}
<script>
  $(document).ready(function(){
    $('.promotion').each(function(){
      let promotion = $(this);
      let promotionId = promotion.data('id');
      promotion.on('click', function(){
        // find .promotion__products for this
        let products = promotion.find('.promotion__products');
        if(products.hasClass('hidden')){
          products.removeClass('hidden');
        } else {
          products.addClass('hidden');
        }
      });
    });
  });
</script>
{% endblock %}