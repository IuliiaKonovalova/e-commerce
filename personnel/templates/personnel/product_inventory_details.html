{% extends "base.html" %}
{% load static %}


{% block content %}
  <div class="dashboard">
    {% if request.user.is_authenticated and not request.user.profile.role.id == 1 %}
      <div class="dashboard__main">
        <h1 class="dashboard__main--name">
          {{ product.name }}
          {% if product.get_recently_created %}
            <span class="new">
              New !
            </span>
          {% endif %}
        </h1>
      </div>
      <a href="{% url 'product_detail_full' pk=product.id %}" aria-label="Go to Promotions page" class="btn btn-primary">
        <i class="fas fa-arrow-circle-left"></i>
        Back to product
      </a>
      <a class="btn btn-primary btn__edit" href="{% url 'edit_product_inventory' pk=product.id inventory_pk=inventory.pk %}">
        <i class="fa fa-pencil"></i>
        Edit Unit
      </a>
      <a class="btn btn-primary btn__delete" href="{% url 'delete_product_inventory' pk=product.id inventory_pk=inventory.pk %}">
        <i class="fas fa-trash-alt"></i>
        Delete Unit
      </a>
      <div class="data__main">
        <span>
          {% if inventory.is_active %}
            <i class="fa fa-check-circle"></i> (Active Unit)
          {% else %}
            <i class="fa fa-times-circle"></i> (Inactive Unit)
          {% endif %}
        </span>
        <div>
          <strong>SKU: </strong>
          {{ inventory.sku }}
        </div>
        <div>
          <strong>UPC: </strong>
          {{ inventory.upc }}
        </div>
        <div>
          <strong>Options: </strong>
          {{ inventory.get_all_attribute_values_str }}
        </div>
        <div>
          <strong>Promo: </strong>
          {% if inPromoNow %}
            <i class="fa fa-check-circle"></i> (Active Promo)
          {% else %}
            <i class="fa fa-times-circle"></i> (Not in Promo)
          {% endif %}
        </div>
        <div>
          <strong>Price: </strong>
          <table>
            <tr>
              <th>Retail</th>
              <th>Store</th>
              <th>Sale</th>
            </tr>
            <tr>
              <td>$ {{ inventory.retail_price }}</td>
              <td>$ {{ inventory.store_price }}</td>
              <td>
                {% if not inventory.store_price == inventory.sale_price %}
                  <div class="data__accent--sale">$ {{ inventory.sale_price }}</div>
                {% else %}
                  <div>$ {{ inventory.sale_price }}</div>
                {% endif %}
              </td>
            </tr>
          </table>
        </div>
        <div>
          <strong>Stock: </strong>
          {% if inventory.stock %}
            {% if inventory.stock.units < 50 and inventory.stock.units >= 25 %}
              <div class="data__accent--yellow">
                <i class="fa fa-exclamation-triangle"></i>
              </div>
            {% elif inventory.stock.units < 25 and inventory.stock.units >= 10 %}
              <div class="data__accent--orange">
                <i class="fa fa-exclamation-triangle"></i>
              </div>
            {% elif inventory.stock.units < 10 and inventory.stock.units >= 0 %}
              <div class="data__accent--redish">
                <i class="fa fa-exclamation-triangle"></i>
              </div>
            {% elif inventory.stock.units == 0 %}
              <div class="data__accent--red">
                <i class="fa fa-exclamation-triangle"></i>
              </div>
            {% else %}
              <div class="data__accent--green">
                <i class="fa fa-exclamation-triangle"></i>
              </div>
            {% endif %}
            <table>
              <tr>
                <th>Purchased</th>
                <th>Left</th>
                <th>Sold</th>
                <th>Last Checked</th>
                <th>Inconcistency</th>
              </tr>
              <tr>
                <td>{{ inventory.stock.units }}</td>
                <td>{{ inventory.stock.units_variable }}</td>
                <td>{{ inventory.stock.units_sold }}</td>
                <td>{{ inventory.stock.last_checked }}</td>
                <td>
                  {% if inventory.stock in stock_inconsistency %}
                    <div class="data__accent--red">
                      <i class="fa fa-exclamation-triangle"></i>
                    </div>
                  {% else %}
                    <div class="data__accent--green">
                      <i class="fa fa-exclamation-triangle"></i>
                    </div>
                  {% endif %}
                </td>
              </tr>
            </table>
            <a href="{% url 'update_stock' pk=product.id inventory_pk=inventory.pk stock_pk=inventory.stock.pk %}" class="btn btn-primary btn__add">
              <i class="fa fa-refresh"></i>
              Update Stock
            </a>
          {% else %}
            <div class="data__accent--red">
              <strong>Stock not found</strong>
              {% comment %} Check if user is admin {% endcomment %}
              {% if request.user.profile.role.id == 3 %}
                <a href="{% url 'add_stock' pk=product.id inventory_pk=inventory.pk %}" class="btn btn-primary btn__add">
                  <i class="fa fa-plus-circle"></i>
                  Add Stock
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="dashboard__main">
        <h1 class="dashboard__main--name">
          You are not authorized to delete categories
        </h1>
      </div>
    {% endif %}
  </div>
{% endblock %}