{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css//multiple-image-video(MIV).css' %}">
{% endblock %}

{% block content %}
  <div class="profile">
    {% if request.user.is_authenticated %}
      <h1>Add review on {{ product.name }}</h1>

      <form method="post" class="form__review">
        <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id="rating">
        <p> Rating: </p>
          <input type="radio" class="btn-check" name="btnradio" id="5" autocomplete="off" checked>
          <label class="btn btn-outline-primary" for="5">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
          </label>
          <input type="radio" class="btn-check" name="btnradio" id="4" autocomplete="off">
          <label class="btn btn-outline-primary" for="4">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
          </label>
        <input type="radio" class="btn-check" name="btnradio" id="3" autocomplete="off">
        <label class="btn btn-outline-primary" for="3">
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
        </label>
        <input type="radio" class="btn-check" name="btnradio" id="2" autocomplete="off">
        <label class="btn btn-outline-primary" for="2">
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
        </label>
        <input type="radio" class="btn-check" name="btnradio" id="1" autocomplete="off">
        <label class="btn btn-outline-primary" for="1">
          <i class="fas fa-star"></i>
        </label>
      </div>
      <div class="form-group">
        <label for="review">Review</label>
        <textarea class="form-control" id="review" name="review" rows="3">{{ review }}</textarea>
      </div>
      {% comment %} Add multiple images {% endcomment %}
      <div class="multiple__images">
        <h2>Add multiple images</h2>
        <a class="cam" href="javascript:void(0)">
          <i class="fas fa-camera"></i>
        </a>
        <div class="gallery"></div>
      </div>
      <div class="form__btns">
        <a href="{% url 'products_table' %}" aria-label="Go to Promotions page" class="btn btn__cancel">
          <i class="fas fa-arrow-circle-left"></i>
          Cancel
        </a>
        <a class="btn btn__add" id="review-submit">
          <i class="fas fa-save"></i>
          Save Review
        </a>
      </div>
    </form>

  {% endif %}
</div>
{% endblock %}

{% block postloadjs_extra %}
<script src="{% static 'js/multiple-image-video(MIV).js' %}"></script>
<script>
    $(document).ready(function() {
      let csrfToken = '{{ csrf_token }}';
      $('.gallery').miv({
        image:'.cam',
        //video:'.vid'
      });
      // get the image files from the .gallery div
      let images = $('.gallery');



      $('#review-submit').on('click', function() {
        console.log('clicked');
        let rating = parseInt($('input[name=btnradio]:checked').attr('id'));
        console.log(rating);
        let review = $('#review').val();
        console.log(review);
        let images = $('.gallery');
        let images_array = [];
        $('input[type=file]').each(function() {
          images_array.push($(this).prop('files')[0]);
        });
        /*
        images.find('img').each(function() {
          let fileInput = $(this).attr('src');
          console.log(fileInput);
          fileInput.type = 'file';
          console.log(fileInput);
          fileInput.accept = 'image/*';
          console.log(fileInput);
          images_array.push(fileInput);
          //images_array.push($(this).attr('src'));
        });
        */
        console.log(images_array);


        // Create formData
        let formData = new FormData();
        formData.append('review', 'hui');
        console.log(formData.values());

        formData.append('user', {{ request.user.id }});

        formData.append('product', {{ product.id }});
        formData.append('order', {{ order.id }});
        formData.append('rating', rating);
        formData.append('comment', review);
        images_array.forEach(function(image) {
          formData.append('images', image);
        });
        //formData.append('images', images_array);
        formData.append('csrfmiddlewaretoken', csrfToken);

        for(let i of formData) {
          console.log(i);
        }
        // formData to string
        let formDataString = JSON.stringify(formData);
        console.log(formDataString);

      })

    });
  </script>


{% endblock %}